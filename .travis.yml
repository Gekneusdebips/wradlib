# run on container-based infrastructure
sudo: false

language: python

addons:
    apt:
        packages:
            - gfortran

env:
  global:
    # wradlib-docs
    - secure: "EuHfeOlRNhTnGbHbyavNwAIjtouQIBDc1iClOtnXV5qoqZ9huooi7kwLxWFkHMsQrqKPNwj0o0mWAeR7Hx2SYtulvWhDhtS1BlfGDNUuDABKmrcp1Fcnk1CVvwx6YxN5w/wwqHC69I/nVYgCmoCt3zB1nA1YBc/hFAlpQBwg7WZmvhyKENQBm+eSjZ6IIbiH17HanD8lhO+kLSZ/KL1hlPbh+8bYXxgt95HQBf+iCtptfIfEnirgL7VXCkFLZjYHgMLHAgwfPKiklA++AC8m0XOxpai/ab1b/87Wpj8Ptpz2BuWFBzBrcMD81TKdRkZwUpIix9dGppR7T/ZgwvjammcS86hoVqmSL3SMfHAM4cF/ddEjE81kqynxHXWMmRFH6bzLrqSnWNUT+y1HcvzPd/C5YKb8XmvFYvHRNE/vdwZtPwo+fQw1QJaLFZmBGJi1cTV8TODlJ1hGAiIgQu9QuqZePHQiV1UCRoMHQYEGKM0QeI0ByMNgcsklwXgdotCpjLZMzkaj1FIivJ/VSiLtlXDx8J+Izrox1KQeCbprf2Lb/kqIqtnlv1FejWqibXgFRgTWtUXxVJVqGgE9ihHKJUHqkzxacjomBXQ3n/U906AxXvQPfzOnTZQVgHUzLNijZLm0OeclwO6RVbD4pOf/rPYdtcY05ZOtiCGx/rSTONU="

matrix:
    include:
    - python: 2.7
      env:
        - PYTHON_VERSION="2.7"
        - COVERALLS="true"
        - DOC_BUILD="true"
    - python: 3.4
      env:
        - PYTHON_VERSION="3.4"
    - python: 3.5
      env:
        - PYTHON_VERSION="3.5"

install: source scripts/install.sh

script:
    - export GDAL_DATA=/home/travis/miniconda2/envs/wradlib/share/gdal
    - xvfb-run coverage run --source wradlib testrunner.py -a

after_success:
    - if [[ "$COVERALLS" == "true" ]]; then coveralls || echo "failed"; fi
    - if [[ "$DOC_BUILD" == "true" ]]; then cd $TRAVIS_BUILD_DIR; scripts/build_docs.sh; fi

deploy:
  provider: pypi
  server: https://testpypi.python.org/pypi
  user: wradlib
  password:
    secure: rKiAS61oDiuV2uJvkP2aiXt8hb7boU2p35RWiTLS8b5pSo/BWysThOIf1jmz5GQIpI8uYU+5GajlgtGVq8GmOxprexDgwTfMFF2bsblfUuZwYM3R1tPQuo2poAZ1/m0jPCul60vJJ31B2wEzsneo4tvbM4a7mAoBMMA5auli5o3eVo4P8xnXziMbw/l53bnl+ZYv7qocbt9RIsrgckAdfjLkZy8gAgDxcYXGGybg6K8VN/twSZGMIJfOvjkONhOtRfsiUc8fEu2hF6+HjQfSC07jue4KDPzo3s9hrAS6+fB0v8MV4UsB710VsrqoPuIfhBRo+xj8tW7Y2MPzJq/6kPBrVoQwV7gLTxZ7IWy5y4/Si78rxhXZIKDzo2VS4tNq1wo6xfGXv8pbzal7TOljqzK+ekXJBsXgdVUiGisZJLHTnPr0rkjwY7qzW+mqPqnpLLTCoHYWQE9AlrEQI3jP1FejGB5iyv/A3kDhjaerFkXlu5TXfkE44EpoKp8uURCNdzNiFoACv/68w3BJmWI0IkQR+YWZEBQm0xySMj8zLd5qrhqX/0u2crEC2uUPEQnkwNF1X8fOz3KFozY68KYsvSmIqKPlJFWSpzXYzMzqFnpvSumgb+g8FK/UppmMpukeQXTVSMGHY9k0Hi6I/WoGgmlDMksRB4fMUG0nZXdOqyM=
  on:
    tags: true
    distributions: sdist
    repo: wradlib/wradlib